@using Microsoft.AspNetCore.Identity
@using MelodyCircle.Data
@inject UserManager<User> UserManager
@inject ApplicationDbContext Context

@{
    ViewData["Title"] = "Admin Panel";
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

<div class="d-flex justify-content-center align-items-center">
	<button type="button" class="border-0 bg-lightBlue unselectable align-items-center" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">
		<img src="~/img/statistic.svg" width="32" height="32" class="mt-5 w-100" />
	</button>
</div>

<div class="offcanvas offcanvas-start border-purple rounded mt-auto m-4 w-25 h-75 text-center align-items-center d-flex flex-column" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
	<div class="offcanvas-header">
		<h2 class="offcanvas-title" id="offcanvasScrollingLabel">Estatísticas</h2>
		<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
	</div>

	<div class="offcanvas-body">
		<h4>Informações da Aplicação</h4>

		<div class="my-4">
			<h6>Utilizadores: @Context.Users.Count()</h6>
			<a class="btn bg-purple text-white my-2" href="@Url.Action("UserCreationStats", "Stat")">Ver Estatísticas de Utilizadores</a>
		</div>

		<div class="my-4">
			<h6>Tutoriais: @Context.Tutorials.Count()</h6>
			<a class="btn bg-purple text-white my-2" href="@Url.Action("TutorialCreationStats", "Stat")">Ver Estatísticas de Tutoriais</a>
		</div>

		<div class="my-4">
			<h6>Steps: @Context.Steps.Count()</h6>
			<a class="btn bg-purple text-white my-2" href="@Url.Action("StepCreationStats", "Stat")">Ver Estatísticas de Passos</a>
		</div>

		<div class="my-4">
			<h6>Collabs: @Context.Collaborations.Count()</h6>
			<a class="btn bg-purple text-white my-2" href="@Url.Action("CollaborationCreationStats", "Stat")">Ver Estatísticas de Colaborações</a>
		</div>

		<!-- This div remains at its place but the content above is centered vertically -->
		<div class="mt-auto">
			<h6>Versão: 1.0.0</h6>
			<h6>Última Atualização:<br> 27 de Março de 2024</h6>
		</div>
	</div>
</div>



<table class="table">
	<thead>
	<tr>
		<th>Username</th>
		<th>Email</th>
		<th>Role</th>
		<th>Actions</th>
	</tr>
	</thead>
	<tbody>
	@foreach (var user in Model)
	{
		<tr>
			<td>@user.UserName</td>
			<td>@user.Email</td>
			<td>
				@{
					var userRoles = await UserManager.GetRolesAsync(user);
					var rolesString = string.Join(", ", userRoles);
				}
				@rolesString
			</td>
			<td>
				<a asp-action="EditUser" asp-area="" asp-controller="Admin" asp-route-id="@user.UserName">Edit</a> |
				<a asp-action="DeleteUser" asp-area="" asp-controller="Admin" asp-route-id="@user.UserName">Delete</a>
			</td>
		</tr>
	}
	</tbody>
</table>

<div>
	<form method="post" asp-action="CreateMultipleUsers">
		<div class="form-group">
			<label for="numberOfUsers">Número de Utilizadores:</label>
			<input type="number" class="form-control" id="numberOfUsers" name="numberOfUsers" value="100">
		</div>
		<button type="submit" class="btn bg-purple text-white">Criar Users</button>
	</form>
	<p></p>
	<form asp-action="DeleteAddedUsers" method="post" asp-controller="Admin">
		<button type="submit" class="btn bg-purple text-white">Excluir Users Criados</button>
	</form>
</div>

<div>
	<form method="post" asp-action="CreateMultipleTutorials">
		<div class="form-group">
			<label for="numberOfTutorials">Número de Tutoriais:</label>
			<input type="number" class="form-control" id="numberOfTutorials" name="numberOfTutorials" value="100">
		</div>
		<button type="submit" class="btn bg-purple text-white">Criar Tutorials</button>
	</form>
	<p></p>
	<form asp-action="DeleteAddedTutorials" method="post" asp-controller="Admin">
		<button type="submit" class="btn bg-purple text-white">Excluir Tutorials Criados</button>
	</form>
</div>

<div>
	<form method="post" asp-action="CreateMultipleCollaborations">
		<div class="form-group">
			<label for="numberOfCollaborations">Número de Colaborações:</label>
			<input type="number" class="form-control" id="numberOfCollaborations" name="numberOfCollaborations" value="100">
		</div>
		<button type="submit" class="btn bg-purple text-white">Criar Collaborations</button>
	</form>
	<p></p>
	<form asp-action="DeleteAddedCollaborations" method="post" asp-controller="Admin">
		<button type="submit" class="btn bg-purple text-white">Excluir Collaborations Criados</button>
	</form>
</div>

<div>
	<form method="post" asp-action="CreateMultipleSteps">
		<div class="form-group">
			<label for="numberOfSteps">Número de Passos:</label>
			<input type="number" class="form-control" id="numberOfSteps" name="numberOfSteps" value="100">
		</div>
		<button type="submit" class="btn bg-purple text-white">Criar Steps</button>
	</form>
	<p></p>
	<form asp-action="DeleteAddedSteps" method="post" asp-controller="Admin">
		<button type="submit" class="btn bg-purple text-white">Excluir Steps Criados</button>
	</form>
</div>


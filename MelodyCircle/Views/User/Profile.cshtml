@model MelodyCircle.ViewModels.ProfileViewModel

@{
    ViewData["Title"] = "Profile";
}

<h1>Profile</h1>

<div>
    <h4>Profile</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.User.UserName)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.User.UserName)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.User.Name)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.User.Name)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.User.ProfilePicture)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.User.ProfilePicture)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.User.BirthDate)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.User.BirthDate)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.User.Gender)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.User.Gender)
        <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Roles)
        </dt>
        <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Roles)
        </dd>
    </dl>
    @if (User.Identity.IsAuthenticated && Model.User.UserName != User.Identity.Name)
    {
        //Model.Context.Entry(Model.User).Collection(u => u.Connections).Load();
        var currentUser = await Model.UserManager.GetUserAsync(User);
        await Model.Context.Entry(currentUser).Collection(u => u.Connections).LoadAsync();
        var isConnected = currentUser.Connections.Find(u => u.UserName == Model.User.UserName);

        if (isConnected == null)
        {
            <form asp-action="AddConnection" asp-route-id="@Model.User.UserName">
                <button type="submit" class="btn btn-primary">Add to Connections</button>
            </form>
        }
        else
        {
            <form asp-action="RemoveConnection" asp-route-id="@Model.User.UserName">
                <button type="submit" class="btn btn-primary">Remove from Connections</button>
            </form>
        }
    }
</div>
<div>
    <a asp-action="Index">Back to List</a>
</div>
